"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[374],{11374:(e,t,r)=>{r.r(t),r.d(t,{default:()=>k});var a=r(73365),s=r(1521),o=r(86123),l=r(33414),i=r(58005),n=r(18159),c=r(41568),d=r(81459),h=r(62150);let u=(0,r(87982).A)("Sparkles",[["path",{d:"M9.937 15.5A2 2 0 0 0 8.5 14.063l-6.135-1.582a.5.5 0 0 1 0-.962L8.5 9.936A2 2 0 0 0 9.937 8.5l1.582-6.135a.5.5 0 0 1 .963 0L14.063 8.5A2 2 0 0 0 15.5 9.937l6.135 1.581a.5.5 0 0 1 0 .964L15.5 14.063a2 2 0 0 0-1.437 1.437l-1.582 6.135a.5.5 0 0 1-.963 0z",key:"4pj2yx"}],["path",{d:"M20 3v4",key:"1olli1"}],["path",{d:"M22 5h-4",key:"1gvqau"}],["path",{d:"M4 17v2",key:"vumght"}],["path",{d:"M5 18H3",key:"zchphs"}]]);var m=r(69515),g=r(12990);let f={HIGH:"bg-red-100 text-red-800 dark:bg-red-900 dark:text-red-200",MEDIUM:"bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200",LOW:"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200"};function k(e){let{householdId:t}=e,{user:r}=(0,h.A)(),[k,x]=(0,s.useState)(!0),[y,v]=(0,s.useState)([]),[p,I]=(0,s.useState)(!1),j=(0,s.useMemo)(()=>{var e,a;return t||(null==r?void 0:null===(a=r.households)||void 0===a?void 0:null===(e=a[0])||void 0===e?void 0:e.id)||localStorage.getItem("household_id")||""},[t,r]);async function N(){try{x(!0);let e=await o.uE.getAIInsights(j);v(e||[])}catch(e){console.error("Failed to load AI insights:",e),(0,d.oR)({title:"AI Insights",description:"Unable to fetch insights at the moment.",variant:"destructive"})}finally{x(!1)}}async function S(e){try{await o.uE.dismissAIInsight(e),v(t=>t.filter(t=>t.id!==e))}catch(e){(0,d.oR)({title:"Action failed",description:"Could not dismiss insight.",variant:"destructive"})}}async function w(){if(j)try{I(!0);let e=new Date,t=e.getFullYear(),r=e.getMonth()+1;await o.uE.generateAIMonthlyReport(j,t,r,{}),(0,d.oR)({title:"Monthly report",description:"AI monthly report generated."}),await N()}catch(e){(0,d.oR)({title:"Generation failed",description:"Could not generate report.",variant:"destructive"})}finally{I(!1)}}return(0,s.useEffect)(()=>{j&&N()},[j]),(0,a.jsxs)(n.Zp,{className:"w-full",children:[(0,a.jsxs)(n.aR,{children:[(0,a.jsxs)(n.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(u,{className:"h-5 w-5 text-purple-500"})," AI Insights"]}),(0,a.jsx)(n.BT,{children:"Personalized, actionable insights from your recent activity."})]}),(0,a.jsxs)(n.Wu,{children:[!j&&(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:"No household selected. Sign in or provide a household ID."}),k?(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsx)(c.EA,{className:"h-5 w-2/3"}),(0,a.jsx)(c.EA,{className:"h-20 w-full"}),(0,a.jsx)(c.EA,{className:"h-5 w-1/3"})]}):0===y.length?(0,a.jsxs)("div",{className:"flex items-center gap-3 rounded-md border p-4",children:[(0,a.jsx)(m.A,{className:"h-5 w-5 text-amber-500"}),(0,a.jsx)("div",{className:"text-sm",children:"No insights yet. Generate a monthly summary to get started."})]}):(0,a.jsx)("div",{className:"space-y-3",children:y.map(e=>(0,a.jsx)("div",{className:"group rounded-md border p-4 transition-colors hover:bg-muted/40",children:(0,a.jsxs)("div",{className:"flex items-start gap-2",children:[(0,a.jsx)(l.E,{className:f[e.priority||"MEDIUM"]||f.MEDIUM,children:e.priority||"MEDIUM"}),(0,a.jsxs)("div",{className:"ml-1 flex-1",children:[(0,a.jsx)("div",{className:"font-medium leading-6",children:e.title}),(0,a.jsx)("div",{className:"text-sm text-muted-foreground",children:e.description}),e.validUntil&&(0,a.jsxs)("div",{className:"mt-1 flex items-center gap-1 text-xs text-muted-foreground",children:[(0,a.jsx)(g.A,{className:"h-3 w-3"})," Valid until ",new Date(e.validUntil).toLocaleDateString()]})]}),(0,a.jsx)(i.$,{variant:"ghost",size:"sm",onClick:()=>S(e.id),children:"Dismiss"})]})},e.id))}),(0,a.jsx)("div",{className:"mt-4 flex justify-end",children:(0,a.jsx)(i.$,{onClick:w,disabled:!j||p,children:p?"Generating...":"Generate Monthly Report"})})]})]})}},12990:(e,t,r)=>{r.d(t,{A:()=>a});let a=(0,r(87982).A)("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]])},62150:(e,t,r)=>{r.d(t,{A:()=>n,AuthProvider:()=>i});var a=r(73365),s=r(1521),o=r(86123);let l=(0,s.createContext)(void 0);function i(e){let{children:t}=e,[r,i]=(0,s.useState)(null),[n,c]=(0,s.useState)(!0);(0,s.useEffect)(()=>{d()},[]);let d=async()=>{try{let e=localStorage.getItem("auth_token");if(!e){c(!1);return}o.uE.setToken(e);let t=await o.uE.request("/auth/me");i(t.user)}catch(e){console.error("Auth check failed:",e),localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),o.uE.clearToken()}finally{c(!1)}},h=async(e,t)=>{try{let{user:r,tokens:a}=await o.uE.request("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})});localStorage.setItem("auth_token",a.accessToken),localStorage.setItem("refresh_token",a.refreshToken),o.uE.setToken(a.accessToken),i(r),f(a.expiresIn)}catch(e){throw console.error("Login failed:",e),e}},u=async(e,t,r)=>{try{let{user:a,tokens:s}=await o.uE.request("/auth/register",{method:"POST",body:JSON.stringify({name:e,email:t,password:r})});localStorage.setItem("auth_token",s.accessToken),localStorage.setItem("refresh_token",s.refreshToken),o.uE.setToken(s.accessToken),i(a),f(s.expiresIn)}catch(e){throw console.error("Registration failed:",e),e}},m=async()=>{try{let e=localStorage.getItem("refresh_token");e&&await o.uE.request("/auth/logout",{method:"POST",body:JSON.stringify({refreshToken:e})})}catch(e){console.error("Logout request failed:",e)}finally{localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),o.uE.clearToken(),i(null)}},g=async()=>{try{let e=localStorage.getItem("refresh_token");if(!e)throw Error("No refresh token available");let{tokens:t}=await o.uE.request("/auth/refresh",{method:"POST",body:JSON.stringify({refreshToken:e})});localStorage.setItem("auth_token",t.accessToken),localStorage.setItem("refresh_token",t.refreshToken),o.uE.setToken(t.accessToken),f(t.expiresIn)}catch(e){throw console.error("Token refresh failed:",e),await m(),e}},f=e=>{setTimeout(()=>{g().catch(console.error)},(e-60)*1e3)};return(0,a.jsx)(l.Provider,{value:{user:r,loading:n,login:h,register:u,logout:m,refreshToken:g},children:t})}function n(){let e=(0,s.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},69515:(e,t,r)=>{r.d(t,{A:()=>a});let a=(0,r(87982).A)("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]])}}]);