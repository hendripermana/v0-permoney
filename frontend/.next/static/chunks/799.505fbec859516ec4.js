"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[799],{55799:(e,t,s)=>{s.r(t),s.d(t,{default:()=>x});var a=s(73365),r=s(1521),o=s(86123),l=s(18159),i=s(58005),n=s(43155),c=s(33414),d=s(41568),u=s(81459),h=s(97286),m=s(87982);let g=(0,m.A)("FileUp",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]]),f=(0,m.A)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);var v=s(62150);function x(e){let{householdId:t,onSuggestionSelected:s}=e,{user:m}=(0,v.A)(),[x,p]=(0,r.useState)(null),[k,y]=(0,r.useState)(!1),[S,j]=(0,r.useState)([]),[N,w]=(0,r.useState)(""),T=(0,r.useMemo)(()=>{var e,s;return t||(null==m?void 0:null===(s=m.households)||void 0===s?void 0:null===(e=s[0])||void 0===e?void 0:e.id)||localStorage.getItem("household_id")||""},[t,m]);async function E(){if(!x){(0,u.oR)({title:"No file",description:"Choose an image or PDF receipt first.",variant:"destructive"});return}if(!T){(0,u.oR)({title:"No household",description:"Please select a household.",variant:"destructive"});return}try{y(!0);let e=await o.uE.uploadDocument(x,{householdId:T,documentType:"RECEIPT"});w(e.id);let t=await o.uE.processDocument(e.id);if(!(null==t?void 0:t.id))throw Error("Processing failed");let s=await o.uE.getTransactionSuggestions(e.id);j(s||[]),(0,u.oR)({title:"Receipt processed",description:"".concat((null==s?void 0:s.length)||0," suggestions found.")})}catch(e){(0,u.oR)({title:"OCR failed",description:(null==e?void 0:e.message)||"Could not process receipt.",variant:"destructive"})}finally{y(!1)}}return(0,a.jsxs)(l.Zp,{children:[(0,a.jsxs)(l.aR,{children:[(0,a.jsxs)(l.ZB,{className:"flex items-center gap-2",children:[(0,a.jsx)(h.A,{className:"h-5 w-5 text-blue-600"})," Scan Receipt (OCR)"]}),(0,a.jsx)(l.BT,{children:"Upload a receipt to auto-fill transaction details."})]}),(0,a.jsxs)(l.Wu,{children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 items-stretch sm:items-center",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)(n.p,{type:"file",accept:"image/*,application/pdf","aria-label":"Upload receipt image or PDF",onChange:e=>{var t;return p((null===(t=e.target.files)||void 0===t?void 0:t[0])||null)}})}),(0,a.jsx)(i.$,{onClick:E,disabled:!x||k,className:"inline-flex items-center gap-2",children:k?"Processing...":(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g,{className:"h-4 w-4"})," Upload & Process"]})})]}),k&&(0,a.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,a.jsx)(d.EA,{className:"h-4 w-2/3"}),(0,a.jsx)(d.EA,{className:"h-4 w-1/3"})]}),S.length>0&&(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("div",{className:"mb-2 text-sm font-medium",children:"Suggestions"}),(0,a.jsx)("div",{className:"space-y-2",children:S.map(e=>{var t;return(0,a.jsxs)("div",{className:"flex items-center justify-between rounded-md border p-3 hover:bg-muted/40",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"h-10 w-10 rounded-md bg-blue-100 dark:bg-blue-950 flex items-center justify-center",children:(0,a.jsx)(f,{className:"h-5 w-5 text-blue-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"font-medium leading-5",children:e.description}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground",children:[new Date(e.date).toLocaleDateString()," • ",e.currency," ",null===(t=e.amount)||void 0===t?void 0:t.toLocaleString()," ",e.merchant?"• ".concat(e.merchant):""]}),e.suggestedCategoryName&&(0,a.jsx)("div",{className:"mt-1",children:(0,a.jsx)(c.E,{variant:"outline",children:e.suggestedCategoryName})})]})]}),(0,a.jsx)(i.$,{size:"sm",onClick:()=>{null==s||s({description:e.description,amount:e.amount,date:new Date(e.date).toISOString().split("T")[0],merchant:e.merchant,suggestedCategoryId:e.suggestedCategoryId})},children:"Apply"})]},e.id)})})]})]})]})}},62150:(e,t,s)=>{s.d(t,{A:()=>n,AuthProvider:()=>i});var a=s(73365),r=s(1521),o=s(86123);let l=(0,r.createContext)(void 0);function i(e){let{children:t}=e,[s,i]=(0,r.useState)(null),[n,c]=(0,r.useState)(!0);(0,r.useEffect)(()=>{d()},[]);let d=async()=>{try{let e=localStorage.getItem("auth_token");if(!e){c(!1);return}o.uE.setToken(e);let t=await o.uE.request("/auth/me");i(t.user)}catch(e){console.error("Auth check failed:",e),localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),o.uE.clearToken()}finally{c(!1)}},u=async(e,t)=>{try{let{user:s,tokens:a}=await o.uE.request("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})});localStorage.setItem("auth_token",a.accessToken),localStorage.setItem("refresh_token",a.refreshToken),o.uE.setToken(a.accessToken),i(s),f(a.expiresIn)}catch(e){throw console.error("Login failed:",e),e}},h=async(e,t,s)=>{try{let{user:a,tokens:r}=await o.uE.request("/auth/register",{method:"POST",body:JSON.stringify({name:e,email:t,password:s})});localStorage.setItem("auth_token",r.accessToken),localStorage.setItem("refresh_token",r.refreshToken),o.uE.setToken(r.accessToken),i(a),f(r.expiresIn)}catch(e){throw console.error("Registration failed:",e),e}},m=async()=>{try{let e=localStorage.getItem("refresh_token");e&&await o.uE.request("/auth/logout",{method:"POST",body:JSON.stringify({refreshToken:e})})}catch(e){console.error("Logout request failed:",e)}finally{localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),o.uE.clearToken(),i(null)}},g=async()=>{try{let e=localStorage.getItem("refresh_token");if(!e)throw Error("No refresh token available");let{tokens:t}=await o.uE.request("/auth/refresh",{method:"POST",body:JSON.stringify({refreshToken:e})});localStorage.setItem("auth_token",t.accessToken),localStorage.setItem("refresh_token",t.refreshToken),o.uE.setToken(t.accessToken),f(t.expiresIn)}catch(e){throw console.error("Token refresh failed:",e),await m(),e}},f=e=>{setTimeout(()=>{g().catch(console.error)},(e-60)*1e3)};return(0,a.jsx)(l.Provider,{value:{user:s,loading:n,login:u,register:h,logout:m,refreshToken:g},children:t})}function n(){let e=(0,r.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}}]);