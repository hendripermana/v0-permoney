"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[180,799],{55799:(e,t,a)=>{a.r(t),a.d(t,{default:()=>v});var s=a(73365),r=a(1521),o=a(86123),l=a(18159),i=a(58005),n=a(43155),c=a(33414),d=a(41568),u=a(81459),h=a(97286),m=a(87982);let g=(0,m.A)("FileUp",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M12 12v6",key:"3ahymv"}],["path",{d:"m15 15-3-3-3 3",key:"15xj92"}]]),f=(0,m.A)("Image",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]]);var p=a(62150);function v(e){let{householdId:t,onSuggestionSelected:a}=e,{user:m}=(0,p.A)(),[v,k]=(0,r.useState)(null),[x,y]=(0,r.useState)(!1),[S,j]=(0,r.useState)([]),[N,w]=(0,r.useState)(""),T=(0,r.useMemo)(()=>{var e,a;return t||(null==m?void 0:null===(a=m.households)||void 0===a?void 0:null===(e=a[0])||void 0===e?void 0:e.id)||localStorage.getItem("household_id")||""},[t,m]);async function b(){if(!v){(0,u.oR)({title:"No file",description:"Choose an image or PDF receipt first.",variant:"destructive"});return}if(!T){(0,u.oR)({title:"No household",description:"Please select a household.",variant:"destructive"});return}try{y(!0);let e=await o.uE.uploadDocument(v,{householdId:T,documentType:"RECEIPT"});w(e.id);let t=await o.uE.processDocument(e.id);if(!(null==t?void 0:t.id))throw Error("Processing failed");let a=await o.uE.getTransactionSuggestions(e.id);j(a||[]),(0,u.oR)({title:"Receipt processed",description:"".concat((null==a?void 0:a.length)||0," suggestions found.")})}catch(e){(0,u.oR)({title:"OCR failed",description:(null==e?void 0:e.message)||"Could not process receipt.",variant:"destructive"})}finally{y(!1)}}return(0,s.jsxs)(l.Zp,{children:[(0,s.jsxs)(l.aR,{children:[(0,s.jsxs)(l.ZB,{className:"flex items-center gap-2",children:[(0,s.jsx)(h.A,{className:"h-5 w-5 text-blue-600"})," Scan Receipt (OCR)"]}),(0,s.jsx)(l.BT,{children:"Upload a receipt to auto-fill transaction details."})]}),(0,s.jsxs)(l.Wu,{children:[(0,s.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2 items-stretch sm:items-center",children:[(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsx)(n.p,{type:"file",accept:"image/*,application/pdf","aria-label":"Upload receipt image or PDF",onChange:e=>{var t;return k((null===(t=e.target.files)||void 0===t?void 0:t[0])||null)}})}),(0,s.jsx)(i.$,{onClick:b,disabled:!v||x,className:"inline-flex items-center gap-2",children:x?"Processing...":(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(g,{className:"h-4 w-4"})," Upload & Process"]})})]}),x&&(0,s.jsxs)("div",{className:"mt-3 space-y-2",children:[(0,s.jsx)(d.EA,{className:"h-4 w-2/3"}),(0,s.jsx)(d.EA,{className:"h-4 w-1/3"})]}),S.length>0&&(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("div",{className:"mb-2 text-sm font-medium",children:"Suggestions"}),(0,s.jsx)("div",{className:"space-y-2",children:S.map(e=>{var t;return(0,s.jsxs)("div",{className:"flex items-center justify-between rounded-md border p-3 hover:bg-muted/40",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsx)("div",{className:"h-10 w-10 rounded-md bg-blue-100 dark:bg-blue-950 flex items-center justify-center",children:(0,s.jsx)(f,{className:"h-5 w-5 text-blue-600"})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"font-medium leading-5",children:e.description}),(0,s.jsxs)("div",{className:"text-xs text-muted-foreground",children:[new Date(e.date).toLocaleDateString()," • ",e.currency," ",null===(t=e.amount)||void 0===t?void 0:t.toLocaleString()," ",e.merchant?"• ".concat(e.merchant):""]}),e.suggestedCategoryName&&(0,s.jsx)("div",{className:"mt-1",children:(0,s.jsx)(c.E,{variant:"outline",children:e.suggestedCategoryName})})]})]}),(0,s.jsx)(i.$,{size:"sm",onClick:()=>{null==a||a({description:e.description,amount:e.amount,date:new Date(e.date).toISOString().split("T")[0],merchant:e.merchant,suggestedCategoryId:e.suggestedCategoryId})},children:"Apply"})]},e.id)})})]})]})]})}},62150:(e,t,a)=>{a.d(t,{A:()=>n,AuthProvider:()=>i});var s=a(73365),r=a(1521),o=a(86123);let l=(0,r.createContext)(void 0);function i(e){let{children:t}=e,[a,i]=(0,r.useState)(null),[n,c]=(0,r.useState)(!0);(0,r.useEffect)(()=>{d()},[]);let d=async()=>{try{let e=localStorage.getItem("auth_token");if(!e){c(!1);return}o.uE.setToken(e);let t=await o.uE.request("/auth/me");i(t.user)}catch(e){console.error("Auth check failed:",e),localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),o.uE.clearToken()}finally{c(!1)}},u=async(e,t)=>{try{let{user:a,tokens:s}=await o.uE.request("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})});localStorage.setItem("auth_token",s.accessToken),localStorage.setItem("refresh_token",s.refreshToken),o.uE.setToken(s.accessToken),i(a),f(s.expiresIn)}catch(e){throw console.error("Login failed:",e),e}},h=async(e,t,a)=>{try{let{user:s,tokens:r}=await o.uE.request("/auth/register",{method:"POST",body:JSON.stringify({name:e,email:t,password:a})});localStorage.setItem("auth_token",r.accessToken),localStorage.setItem("refresh_token",r.refreshToken),o.uE.setToken(r.accessToken),i(s),f(r.expiresIn)}catch(e){throw console.error("Registration failed:",e),e}},m=async()=>{try{let e=localStorage.getItem("refresh_token");e&&await o.uE.request("/auth/logout",{method:"POST",body:JSON.stringify({refreshToken:e})})}catch(e){console.error("Logout request failed:",e)}finally{localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),o.uE.clearToken(),i(null)}},g=async()=>{try{let e=localStorage.getItem("refresh_token");if(!e)throw Error("No refresh token available");let{tokens:t}=await o.uE.request("/auth/refresh",{method:"POST",body:JSON.stringify({refreshToken:e})});localStorage.setItem("auth_token",t.accessToken),localStorage.setItem("refresh_token",t.refreshToken),o.uE.setToken(t.accessToken),f(t.expiresIn)}catch(e){throw console.error("Token refresh failed:",e),await m(),e}},f=e=>{setTimeout(()=>{g().catch(console.error)},(e-60)*1e3)};return(0,s.jsx)(l.Provider,{value:{user:a,loading:n,login:u,register:h,logout:m,refreshToken:g},children:t})}function n(){let e=(0,r.useContext)(l);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},97286:(e,t,a)=>{a.d(t,{A:()=>s});let s=(0,a(87982).A)("WandSparkles",[["path",{d:"m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72",key:"ul74o6"}],["path",{d:"m14 7 3 3",key:"1r5n42"}],["path",{d:"M5 6v4",key:"ilb8ba"}],["path",{d:"M19 14v4",key:"blhpug"}],["path",{d:"M10 2v2",key:"7u0qdc"}],["path",{d:"M7 8H3",key:"zfb6yr"}],["path",{d:"M21 16h-4",key:"1cnmox"}],["path",{d:"M11 3H9",key:"1obp7u"}]])}}]);