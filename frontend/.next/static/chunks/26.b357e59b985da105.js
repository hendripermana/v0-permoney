"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[26],{62150:(e,t,a)=>{a.d(t,{A:()=>i,AuthProvider:()=>n});var l=a(73365),o=a(1521),r=a(86123);let s=(0,o.createContext)(void 0);function n(e){let{children:t}=e,[a,n]=(0,o.useState)(null),[i,c]=(0,o.useState)(!0);(0,o.useEffect)(()=>{u()},[]);let u=async()=>{try{let e=localStorage.getItem("auth_token");if(!e){c(!1);return}r.uE.setToken(e);let t=await r.uE.request("/auth/me");n(t.user)}catch(e){console.error("Auth check failed:",e),localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),r.uE.clearToken()}finally{c(!1)}},d=async(e,t)=>{try{let{user:a,tokens:l}=await r.uE.request("/auth/login",{method:"POST",body:JSON.stringify({email:e,password:t})});localStorage.setItem("auth_token",l.accessToken),localStorage.setItem("refresh_token",l.refreshToken),r.uE.setToken(l.accessToken),n(a),k(l.expiresIn)}catch(e){throw console.error("Login failed:",e),e}},h=async(e,t,a)=>{try{let{user:l,tokens:o}=await r.uE.request("/auth/register",{method:"POST",body:JSON.stringify({name:e,email:t,password:a})});localStorage.setItem("auth_token",o.accessToken),localStorage.setItem("refresh_token",o.refreshToken),r.uE.setToken(o.accessToken),n(l),k(o.expiresIn)}catch(e){throw console.error("Registration failed:",e),e}},m=async()=>{try{let e=localStorage.getItem("refresh_token");e&&await r.uE.request("/auth/logout",{method:"POST",body:JSON.stringify({refreshToken:e})})}catch(e){console.error("Logout request failed:",e)}finally{localStorage.removeItem("auth_token"),localStorage.removeItem("refresh_token"),r.uE.clearToken(),n(null)}},v=async()=>{try{let e=localStorage.getItem("refresh_token");if(!e)throw Error("No refresh token available");let{tokens:t}=await r.uE.request("/auth/refresh",{method:"POST",body:JSON.stringify({refreshToken:e})});localStorage.setItem("auth_token",t.accessToken),localStorage.setItem("refresh_token",t.refreshToken),r.uE.setToken(t.accessToken),k(t.expiresIn)}catch(e){throw console.error("Token refresh failed:",e),await m(),e}},k=e=>{setTimeout(()=>{v().catch(console.error)},(e-60)*1e3)};return(0,l.jsx)(s.Provider,{value:{user:a,loading:i,login:d,register:h,logout:m,refreshToken:v},children:t})}function i(){let e=(0,o.useContext)(s);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}},63645:(e,t,a)=>{a.r(t),a.d(t,{default:()=>v});var l=a(73365),o=a(1521),r=a(86123),s=a(18159),n=a(58005),i=a(43155),c=a(41568),u=a(81459);let d=(0,a(87982).A)("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);var h=a(11892),m=a(62150);function v(e){var t,a,v,k,f,y;let{householdId:x}=e,{user:g}=(0,m.A)(),[S,p]=(0,o.useState)(!1),[w,N]=(0,o.useState)(null),[T,j]=(0,o.useState)(""),b=(0,o.useMemo)(()=>{var e,t;return x||(null==g?void 0:null===(t=g.households)||void 0===t?void 0:null===(e=t[0])||void 0===e?void 0:e.id)||localStorage.getItem("household_id")||""},[x,g]);async function I(){if(!b){(0,u.oR)({title:"Missing household",description:"Select a household first.",variant:"destructive"});return}try{p(!0);let e=await r.uE.calculateZakat({householdId:b,calculationDate:T||void 0});N(e)}catch(e){(0,u.oR)({title:"Calculation failed",description:"Unable to calculate zakat.",variant:"destructive"})}finally{p(!1)}}function E(e,t){try{return new Intl.NumberFormat("id-ID",{style:"currency",currency:t,minimumFractionDigits:0}).format(e)}catch(a){return"".concat(t," ").concat(null==e?void 0:e.toLocaleString())}}return(0,l.jsxs)(s.Zp,{children:[(0,l.jsxs)(s.aR,{children:[(0,l.jsxs)(s.ZB,{className:"flex items-center gap-2",children:[(0,l.jsx)(d,{className:"h-5 w-5 text-green-600"})," Zakat (Quick)"]}),(0,l.jsx)(s.BT,{children:"One-click zakat calculation using your latest balances."})]}),(0,l.jsx)(s.Wu,{children:b?S?(0,l.jsxs)("div",{className:"space-y-3",children:[(0,l.jsx)(c.EA,{className:"h-4 w-1/3"}),(0,l.jsx)(c.EA,{className:"h-6 w-full"})]}):(0,l.jsxs)("div",{className:"space-y-4",children:[(0,l.jsxs)("div",{className:"flex flex-col sm:flex-row items-stretch sm:items-center gap-2",children:[(0,l.jsx)(i.p,{type:"date",value:T,onChange:e=>j(e.target.value),className:"sm:max-w-xs",placeholder:"Calculation date (optional)"}),(0,l.jsxs)(n.$,{onClick:I,className:"inline-flex items-center gap-2",children:[(0,l.jsx)(h.A,{className:"h-4 w-4"})," Calculate"]})]}),w&&(0,l.jsxs)("div",{className:"rounded-md border p-3 text-sm",children:[(0,l.jsx)("div",{className:"mb-1 font-medium",children:"Summary"}),(0,l.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2",children:[(0,l.jsxs)("div",{children:["Nisab: ",E(null==w?void 0:null===(t=w.nisabThreshold)||void 0===t?void 0:t.amount,null==w?void 0:null===(a=w.nisabThreshold)||void 0===a?void 0:a.currency)]}),(0,l.jsxs)("div",{children:["Zakatable: ",E(null==w?void 0:null===(v=w.totalZakatableAssets)||void 0===v?void 0:v.amount,null==w?void 0:null===(k=w.totalZakatableAssets)||void 0===k?void 0:k.currency)]}),(0,l.jsxs)("div",{children:["Due: ",E(null==w?void 0:null===(f=w.zakatAmount)||void 0===f?void 0:f.amount,null==w?void 0:null===(y=w.zakatAmount)||void 0===y?void 0:y.currency)]}),(0,l.jsxs)("div",{children:["Status: ",(null==w?void 0:w.isZakatDue)?"Zakat Due":"Not Due"]})]})]})]}):(0,l.jsx)("div",{className:"text-sm text-muted-foreground",children:"No household selected."})})]})}}}]);